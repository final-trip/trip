<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.ssafy.mountain.model.mapper.MountainMapper">

	<resultMap id="mountainResultMap"
		type="com.ssafy.mountain.model.MountainDto">
		<id property="mntilistno" column="mntilistno" />
		<result property="mntiname" column="mntiname" />
		<result property="mntidetails" column="mntidetails" />
		<result property="mntiadd" column="mntiadd" />
		<result property="mntihigh" column="mntihigh" />
		<result property="sido_code" column="sido_code" />
		<result property="gugun_code" column="gugun_code" />
		<result property="mntiimg" column="mntiimg" />
	</resultMap>

	<insert id="addMountain"
		parameterType="com.ssafy.mountain.model.MountainDto">
		INSERT INTO mountain (mntiname, mntidetails, mntiadd,
		mntihigh,
		sido_code, gugun_code, mntiimg)
		VALUES (#{mntiname},
		#{mntidetails}, #{mntiadd}, #{mntihigh}, #{sido_code},
		#{gugun_code},
		#{mntiimg})
	</insert>

	<insert id="AddConqueredMountain"
		parameterType="com.ssafy.mountain.model.MountainDto">
		INSERT INTO membermountain ( member_id ,
		mntilistno)
		VALUES ( #{memberid}, #{mntilistno})
	</insert>

	<select id="getUnconqueredMountains" parameterType="int"
		resultMap="mountainResultMap">
		SELECT * FROM mountain
		WHERE mntilistno NOT IN (
		SELECT
		mm.mntilistno FROM membermountain mm
		WHERE mm.memberid = #{memberid}
		)
	</select>

	<select id="getUnconqueredMountainsAscendingByHeight"
		parameterType="int" resultMap="mountainResultMap">
		SELECT * FROM mountain
		WHERE mntilistno
		NOT IN (
		SELECT mm.mntilistno FROM membermountain mm
		WHERE mm.memberid
		= #{memberid}
		)
		ORDER BY mntihigh ASC
	</select>

	<select id="getNearestUnconqueredMountains" parameterType="int"
		resultMap="mountainResultMap">
		SELECT * FROM mountain
		WHERE mntilistno NOT IN (
		SELECT
		mm.mntilistno FROM membermountain mm
		WHERE mm.memberid = #{memberid}
		)
		ORDER BY
		DISTANCE_TO_MEMBER_FUNCTION(mntilistno, #{memberid})
	</select>

	<select id="getAllMountains" resultMap="mountainResultMap">
		SELECT * FROM mountain
	</select>

</mapper>
